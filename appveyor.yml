platform: x64
image: Visual Studio 2015

environment:
  global:
    XGBOOST_VERSION: 42
    LIBHDFS_DIR: '%APPVEYOR_BUILD_FOLDER%\libhdfs-dev'
    HADOOP_VERSION: 2.6.0-cdh5.5.0
    SPARK_VERSION: 2.1.0
    SCALA_VERSION: 2.10.6
  matrix:
    - JAVA_HOME: C:\Program Files\Java\jdk1.8.0
    # - JAVA_HOME: C:\Program Files (x86)\Java\jdk1.8.0

clone_script:
  - git clone -q --branch=%APPVEYOR_REPO_BRANCH% https://github.com/%APPVEYOR_REPO_NAME%.git %APPVEYOR_BUILD_FOLDER%
  - cd %APPVEYOR_BUILD_FOLDER%
  - git checkout -qf %APPVEYOR_REPO_COMMIT%
  - git submodule update --init --recursive
  - git submodule foreach --recursive git pull origin master

install:
  - 'SET PATH=C:\mingw-w64\x86_64-6.3.0-posix-seh-rt_v5-rev1\mingw64\bin;%PATH%'
  - 'SET PATH=%VS140COMNTOOLS%\..\IDE;%PATH%'
  - ps: If (!(Test-Path -Path $env:LIBHDFS_DIR)) { iex 'C:\Python36-x64\python.exe install_libhdfs.py' }

build_script:
  - 'C:\Python36-x64\python.exe install_xgboost.py'

test_script:
  - cd xgboost
  - 'SET HADOOP_HOME=%CD%'
  - cd jvm-packages
  - mvn -q package -pl :xgboost4j,:xgboost4j-spark

# cache:
#   - '%LIBHDFS_DIR%'
